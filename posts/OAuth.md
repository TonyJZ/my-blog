# OAuth 协议及应用

## OAuth 是什么？

OAuth 是一种开放的授权协议，用于允许 web、移动和桌面应用程序以简单和标准的方法进行安全授权。"An open protocol to allow secure authorization in a simple and standard method from web, mobile and desktop applications."——OAuth 官网介绍

注意，OAuth 关注的是 **Authorization**（授权）的层面（即“What”），而不是 **Authentication**（认证）的层面（即“Who”），关于Authentication（认证）相关的标准协议我们后面会有专门的文章描述。

## OAuth能解决什么问题?

在传统的授权领域中，第三方应用请求用户的受保护的资源时，服务端会通过使用用户的账密凭证在服务器上进行身份验证（HTTP Basic Authentication），以便为第三方应用程序提供访问权限，这也就进一步要求用户与第三方应用之间共享授权凭证。

### 场景1

应用 A 想访问用户 B 的支付宝账号信息，按照传统的解决方案，那就是应用 A 要求用户 B 在应用 A 中输入支付宝账号密码，然后应用 A 再使用用户 B 的账号密码去支付宝获取该用户的账号信息。这种方式无疑会造成下面几种问题：

* 第三方应用需要提前存储用户的账号密码以供将来使用；
* 尽管使用密码存在安全缺陷，但服务器仍然需要支持密码身份验证；
* 第三方应用可以直接获取用户所有的受保护的资源，但用户却无法对具体的资源行使过于精细化的访问控制权；
* 用户如果想撤销第三方应用对某个资源的访问权限，只能更改账号密码；
* 极其容易造成由于第三方应用的安全问题导致用户数据的大批量泄露；

### 场景2

有一个"云冲印"的网站，可以将用户储存在Google的照片，冲印出来。用户为了使用该服务，必须让"云冲印"读取自己储存在Google上的照片。

问题是只有得到用户的授权，Google才会同意"云冲印"读取这些照片。那么，"云冲印"怎样获得用户的授权呢？

传统方法是，用户将自己的Google用户名和密码，告诉"云冲印"，后者就可以读取用户的照片了。这样的做法有以下几个严重的缺点。

（1）"云冲印"为了后续的服务，会保存用户的密码，这样很不安全。

（2）Google不得不部署密码登录，而我们知道，单纯的密码登录并不安全。

（3）"云冲印"拥有了获取用户储存在Google所有资料的权力，用户没法限制"云冲印"获得授权的范围和有效期。

（4）用户只有修改密码，才能收回赋予"云冲印"的权力。但是这样做，会使得其他所有获得用户授权的第三方应用程序全部失效。

（5）只要有一个第三方应用程序被破解，就会导致用户密码泄漏，以及所有被密码保护的数据泄漏。

OAuth 的出现，彻底改变了双方系统之间只能通过暴露账密去授权获取用户数据的方式。OAuth 通过在第三方应用与服务提供方之间引入了一个授权层来解决这些问题。首先就要求第三方应用不能直接登录服务提供方，只能先登录授权层，获取到授权层颁发的访问令牌，然后通过这个令牌才能获取到相应权限的资源（并非全部资源），以此将第三方应用与服务提供方区分开。

